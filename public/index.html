<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>zoom2srt | Unofficial zoom chat to subtitle converter</title>

    <link rel="stylesheet" href="style.css" type="text/css" media="screen" />
    <script type="text/javascript" src="script.js"></script>
    <script type="text/javascript">
      let rawChat = "";
      let rawMessages = [];
      function nickStyle() {
        return document.querySelector('input[name="style"]:checked').value;
      }
      function gatherOpts() {
        const pad2 = (s) => s.toString().padStart(2, "0");
        const duration = document.getElementById("duration").value;
        const minutes = pad2(document.getElementById("minutes").value);
        const seconds = pad2(document.getElementById("seconds").value);
        return {
          duration: parseInt(duration),
          nickStyle: nickStyle(),
          offset: `00:${minutes}:${seconds}`,
        };
      }
      function updateMessages() {
        let { offset, duration } = gatherOpts();
        rawMessages = offsetIt(parseIt(rawChat, duration), offset);
      }
      function updatePreview() {
        const previewSub = (sub) => sub.split("\n\n").slice(0, 2).join("\n\n");
        const containerDiv = document.getElementById("platform");
        const finalSubs = processChat(rawChat, gatherOpts());
        containerDiv.innerText = previewSub(finalSubs);
      }
      function clickDownload() {
        const downloadAnchor = document.createElement("a");
        downloadAnchor.setAttribute("download", "subtitle.srt"); // TODO: get a proper filename
        downloadAnchor.setAttribute(
          "href",
          "data:text/plain;charset=utf-8," +
            encodeURIComponent(formatIt(rawMessages, nickStyle()))
        );
        downloadAnchor.style.display = "none";
        document.body.appendChild(downloadAnchor);
        downloadAnchor.click();
        document.body.removeChild(downloadAnchor);
      }
      function loadChat() {
        function showSettings() {
          document.getElementById("settings").style.display = null;
          document.getElementById("upload").style.display = "none";
        }
        const chatfileEle = document.getElementById("chatfile");
        const [chatfile] = chatfileEle.files;
        const reader = new FileReader();
        reader.addEventListener(
          "load",
          () => {
            rawChat = reader.result;
            showSettings();
            updateMessages();
            /* updatePreview(); */
            chatfileEle.value = null; // forget about filename
          },
          false
        );
        if (chatfile) reader.readAsText(chatfile);
      }
    </script>
    <meta name="title" content="zoom2srt" />
    <meta
      name="description"
      content="Unofficial zoom chat to subtitle converter"
    />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="zoom2srt" />
    <meta
      property="og:description"
      content="Unofficial zoom chat to subtitle converter"
    />
    <link
      href="img/light-mode-favicon.ico"
      rel="icon"
      media="(prefers-color-scheme: light)"
      type="image/x-icon"
    />
    <link
      href="img/dark-mode-favicon.ico"
      rel="icon"
      media="(prefers-color-scheme: dark)"
      type="image/x-icon"
    />
    <link
      href="img/light-mode-apple-touch-icon.png"
      rel="apple-touch-icon"
      media="(prefers-color-scheme: light)"
    />
    <link
      href="img/dark-mode-apple-touch-icon.png"
      rel="apple-touch-icon"
      media="(prefers-color-scheme: dark)"
    />
  </head>
  <body>
    <header>
      <h1>zoom2srt</h1>
    </header>
    <main>
      <div id="upload">
        <fieldset>
          <legend>Select a Zoom .txt chat file to upload</legend>
          <input
            type="file"
            id="chatfile"
            name="chatfile"
            accept=".txt"
            onchange="loadChat()"
          />
        </fieldset>
      </div>
      <div id="platform"></div>
      <div id="settings" style="display: none">
        <fieldset class="styles">
          <legend title="Style to apply to message nicknames">
            Nick style
          </legend>
          <input type="radio" name="style" id="none" value="none" checked />
          <label for="colors">none</label>
          <input type="radio" name="style" id="colors" value="colors" />
          <label for="colors" title="A different color for each nick"
            >colorized</label
          >
          <input type="radio" name="style" id="bold" value="bold" />
          <label for="colors">bold</label>
        </fieldset>
        <fieldset class="duration">
          <legend title="How long each chat message stays on-screen">
            Message duration
          </legend>
          <input
            onchange="updateMessages()"
            type="number"
            name="duration"
            id="duration"
            min="1"
            max="99"
            value="5"
            required
          />
          <label for="duration">seconds </label>
        </fieldset>
        <fieldset class="offset">
          <legend
            title="For when some of the beginning of the video has been cut out"
          >
            Start time offset
          </legend>
          <input
            type="number"
            name="minutes"
            id="minutes"
            min="0"
            max="59"
            value="0"
            onchange="updateMessages()"
          />
          <label for="minutes">minutes</label>
          <input
            type="number"
            name="seconds"
            id="seconds"
            min="0"
            max="59"
            value="0"
            onchange="updateMessages()"
          />
          <label for="seconds">seconds</label>
        </fieldset>
        <div class="download">
          <button onclick="clickDownload()">Download!</button>
        </div>
      </div>
    </main>
    <footer>Copyright © 2024 azimut ― All rights reserved.</footer>
    <!-- Cloudflare Web Analytics -->
    <script
      defer
      src="https://static.cloudflareinsights.com/beacon.min.js"
      data-cf-beacon='{"token": "a6847e40b42c4009813b1f275831b258"}'
    ></script>
    <!-- End Cloudflare Web Analytics -->
  </body>
</html>
